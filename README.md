# salvage-n-sustain
by Clara Hong (clarashong). \
Submission for Green Pioneers

# Description
A big environmental problem is excessive waste generation that fills up landfills and pollutes the environment. Salvage 'N' Sustain acts as the first step for anyone looking to dispose something that could possibly e repurposed or given away. The site acts as a central location for programs, drives, events that promote reuse and sustainability. For those who don't find any matching posts, it also provides a disposal guide on how to properly dispose items according to city guidelines. Anyone, whether for personal/local programs or company/organization initiatives, can post to the posting board and contribute to waste reduction! 

# Purpose
The site works to reduce the waste caused by consumption culture as well as promote resource sharing and eco-friendly initiatives. 

# Built with  
- React (frontend) 
- Express.js (backend) 
- Supabase (database and authentication)
- Google Gemini (disposal guide generation)
- Vercel (deployment)

# Demo 
**Note:** As of March 13, this project is now taken off of Vercel deployment to save resources.  
This project is deployed on Vercel. Access the site here: https://salvage-n-sustain-frontend.vercel.app/  (now disabled)
Because of API limits, please be mindful of the number of "disposal guide" searches. Supabase RLS is enabled for the public for data protection.

# Getting keys and variables
1. Get a free Google Gemini key at: https://aistudio.google.com/app/apikey

# Set up 
Prerequisites: 
- Node (npm)
- Have supabase variables provided **or** Supabase project replicated (see "about the database") 

1. Clone the repository 
2. Install the required npm packages in the project, client, server folders:   
```
    # in project folder 
    npm install 
    
    # install client dependencies
    cd client 
    npm install 

    # install server dependencies
    cd ../server
    npm install 
```
3. Fill in env variables for Supabase. 
- In client folder 
  - create a blank .env.local file 
  - fill it in based on .env.local.example  
```
    REACT_APP_SUPABASE_URL="project-url-here"
    REACT_APP_SUPABASE_ANON_KEY="anon-key-here"
```
- In server folder 
  - create a blank .env file 
  - fill it in based on .env.example
```
    SUPABASE_URL="project-url-here"
    SUPABASE_ANON_KEY="anon-key-here"
    GEMINI_API_KEY="your-key-here"
```

# Running the application
1. In the project folder use command to start the client and server:  
  ``` 
  npm run dev 
  ``` 

## About the database
This project uses a live Supabase database, and it's connection details are contained in environment variables. Row Level Security is enabled as well, ensuring data protection. To replicate the supabase setup. Follow these steps: 
1. Sign up/login into supabase and create a free supabase project
2. Create a 'posts' table: 
```
create table public.posts (
  id bigint generated by default as identity not null,
  title text not null default ''::text,
  user_id uuid not null default gen_random_uuid (),
  created_at timestamp with time zone not null default now(),
  description text null default ''::text,
  start_date timestamp with time zone null,
  end_date timestamp with time zone null,
  location jsonb null,
  image_url text null default ''::text,
  user_name text not null default ''::text,
  items jsonb[] null default '{}'::jsonb[],
  constraint posts_pkey primary key (id),
  constraint posts_id_key unique (id)
) TABLESPACE pg_default;
```

2. Run this in the SQL Editor: 
```
CREATE OR REPLACE FUNCTION public.get_items_search(items_param text) 
RETURNS TABLE (post_id bigint, post_title text, post_description text, post_items jsonb[], post_start_date timestamp with time zone, post_end_date timestamp with time zone, post_location jsonb, post_image_url text, post_user_name text) AS $$  
BEGIN
  RETURN QUERY  
  SELECT posts.id, posts.title, posts.description, posts.items, posts.start_date, posts.end_date, posts.location, posts.image_url, posts.user_name
  FROM posts 
  WHERE items::text ilike ('%' || items_param ||'%') 
  OR description ILIKE ('%' || items_param || '%') 
  OR title ILIKE ('%' || items_param || '%'); 
END;
$$ LANGUAGE plpgsql;
```

3. Go to project settings > data api, you will need the project url and the anon to fill in the env variables in both the client and server folders. 

